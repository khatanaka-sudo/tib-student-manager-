<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TIB å­¦ç”Ÿãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #f5f4f0;
  --white: #ffffff;
  --border: #e0ddd6;
  --border-dark: #c8c4bb;
  --text: #1a1916;
  --muted: #8a8680;
  --accent: #2d5a3d;
  --accent-light: #e8f0eb;
  --accent2: #c4501a;
  --accent2-light: #fdf0eb;
  --accent3: #1a4a6e;
  --accent3-light: #e8eef5;
  --accent4: #6e4a1a;
  --accent4-light: #f5ede8;
  --tag-green: #2d5a3d;
  --tag-orange: #c4501a;
  --tag-blue: #1a4a6e;
  --row-hover: #faf9f7;
  --shadow: 0 1px 4px rgba(0,0,0,0.08);
  --radius: 8px;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Noto Sans JP', sans-serif;
  background: var(--bg);
  color: var(--text);
  font-size: 13px;
  min-height: 100vh;
}

/* ===== LAYOUT ===== */
.app { display: flex; height: 100vh; overflow: hidden; }

/* Sidebar */
.sidebar {
  width: 220px;
  flex-shrink: 0;
  background: var(--white);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  padding: 0;
  overflow-y: auto;
}

.sidebar-logo {
  padding: 20px 20px 16px;
  border-bottom: 1px solid var(--border);
}

.logo-badge {
  display: inline-block;
  background: var(--accent);
  color: white;
  font-family: 'DM Mono', monospace;
  font-size: 11px;
  font-weight: 500;
  letter-spacing: 1px;
  padding: 3px 8px;
  border-radius: 3px;
  margin-bottom: 6px;
}

.logo-title {
  font-size: 14px;
  font-weight: 700;
  color: var(--text);
  line-height: 1.3;
}

.logo-sub {
  font-size: 10px;
  color: var(--muted);
  margin-top: 2px;
}

.sidebar-nav {
  padding: 12px 8px;
  flex: 1;
}

.nav-section-label {
  font-size: 9px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--muted);
  padding: 8px 12px 4px;
  font-family: 'DM Mono', monospace;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  border-radius: 6px;
  cursor: pointer;
  color: var(--muted);
  transition: all 0.15s;
  margin-bottom: 2px;
}

.nav-item:hover { background: var(--bg); color: var(--text); }
.nav-item.active { background: var(--accent-light); color: var(--accent); font-weight: 500; }
.nav-icon { font-size: 15px; width: 18px; text-align: center; }
.nav-label { font-size: 12px; }

.nav-count {
  margin-left: auto;
  font-family: 'DM Mono', monospace;
  font-size: 10px;
  background: var(--border);
  padding: 1px 6px;
  border-radius: 10px;
  color: var(--muted);
}

.nav-item.active .nav-count {
  background: var(--accent);
  color: white;
}

.sidebar-footer {
  padding: 12px 16px;
  border-top: 1px solid var(--border);
  font-size: 10px;
  color: var(--muted);
  font-family: 'DM Mono', monospace;
}

/* Main */
.main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }

/* Topbar */
.topbar {
  background: var(--white);
  border-bottom: 1px solid var(--border);
  padding: 0 24px;
  height: 52px;
  display: flex;
  align-items: center;
  gap: 16px;
  flex-shrink: 0;
}

.topbar-title {
  font-size: 15px;
  font-weight: 700;
  color: var(--text);
}

.topbar-sub {
  font-size: 11px;
  color: var(--muted);
}

.topbar-actions { margin-left: auto; display: flex; gap: 8px; }

.btn {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 6px 14px;
  border-radius: 6px;
  font-size: 12px;
  font-family: 'Noto Sans JP', sans-serif;
  cursor: pointer;
  border: none;
  transition: all 0.15s;
  font-weight: 500;
}

.btn-primary { background: var(--accent); color: white; }
.btn-primary:hover { background: #245030; }
.btn-secondary { background: var(--white); color: var(--text); border: 1px solid var(--border-dark); }
.btn-secondary:hover { background: var(--bg); }
.btn-danger { background: #fff0ed; color: var(--accent2); border: 1px solid #f5c4b4; }
.btn-danger:hover { background: #ffe5dd; }
.btn-sm { padding: 4px 10px; font-size: 11px; }

/* Content */
.content { flex: 1; overflow-y: auto; padding: 24px; }

/* Panel system */
.panel { display: none; }
.panel.active { display: block; animation: fadeIn 0.2s ease; }

@keyframes fadeIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }

/* Stats cards */
.stats-row {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
  margin-bottom: 20px;
}

.stat-card {
  background: var(--white);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 16px;
  position: relative;
  overflow: hidden;
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 3px;
}

.stat-card.green::before { background: var(--accent); }
.stat-card.orange::before { background: var(--accent2); }
.stat-card.blue::before { background: var(--accent3); }
.stat-card.brown::before { background: var(--accent4); }

.stat-icon { font-size: 18px; margin-bottom: 8px; }
.stat-value { font-family: 'DM Mono', monospace; font-size: 26px; font-weight: 500; color: var(--text); }
.stat-label { font-size: 11px; color: var(--muted); margin-top: 2px; }
.stat-sub { font-size: 10px; color: var(--muted); margin-top: 4px; font-family: 'DM Mono', monospace; }

/* Table */
.table-wrapper {
  background: var(--white);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  box-shadow: var(--shadow);
}

.table-header {
  display: flex;
  align-items: center;
  padding: 12px 16px;
  border-bottom: 1px solid var(--border);
  gap: 12px;
  background: var(--white);
}

.table-header-title {
  font-weight: 700;
  font-size: 13px;
}

.search-box {
  display: flex;
  align-items: center;
  gap: 6px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 5px 10px;
  margin-left: auto;
}

.search-box input {
  border: none;
  background: transparent;
  outline: none;
  font-size: 12px;
  font-family: 'Noto Sans JP', sans-serif;
  width: 160px;
  color: var(--text);
}

.search-box input::placeholder { color: var(--muted); }

table {
  width: 100%;
  border-collapse: collapse;
}

th {
  background: var(--bg);
  padding: 8px 14px;
  text-align: left;
  font-size: 10px;
  font-family: 'DM Mono', monospace;
  letter-spacing: 0.5px;
  color: var(--muted);
  border-bottom: 1px solid var(--border);
  white-space: nowrap;
  font-weight: 500;
}

td {
  padding: 9px 14px;
  border-bottom: 1px solid var(--border);
  font-size: 12px;
  color: var(--text);
  vertical-align: middle;
}

tr:last-child td { border-bottom: none; }
tr:hover td { background: var(--row-hover); }

/* Tags */
.tag {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 10px;
  font-weight: 500;
  white-space: nowrap;
}

.tag-green { background: var(--accent-light); color: var(--tag-green); }
.tag-orange { background: var(--accent2-light); color: var(--tag-orange); }
.tag-blue { background: var(--accent3-light); color: var(--tag-blue); }
.tag-brown { background: var(--accent4-light); color: var(--accent4); }
.tag-gray { background: var(--bg); color: var(--muted); border: 1px solid var(--border); }

/* Role tags */
.role-chip {
  display: inline-block;
  padding: 1px 7px;
  border-radius: 10px;
  font-size: 10px;
  font-weight: 500;
}

/* Attendance dots */
.attend-dots { display: flex; gap: 3px; flex-wrap: wrap; }
.dot {
  width: 10px; height: 10px;
  border-radius: 2px;
}
.dot-present { background: var(--accent); }
.dot-absent { background: var(--border); }

/* Progress bar */
.mini-bar {
  width: 60px;
  height: 4px;
  background: var(--border);
  border-radius: 2px;
  overflow: hidden;
  display: inline-block;
  vertical-align: middle;
  margin-right: 6px;
}

.mini-bar-fill {
  height: 100%;
  border-radius: 2px;
  background: var(--accent);
}

/* Modal */
.modal-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.3);
  z-index: 100;
  align-items: center;
  justify-content: center;
}

.modal-overlay.open { display: flex; }

.modal {
  background: var(--white);
  border-radius: 12px;
  padding: 28px;
  width: 480px;
  max-width: 95vw;
  max-height: 85vh;
  overflow-y: auto;
  box-shadow: 0 8px 32px rgba(0,0,0,0.15);
  animation: slideUp 0.2s ease;
}

@keyframes slideUp { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }

.modal-title {
  font-size: 16px;
  font-weight: 700;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.form-row { margin-bottom: 14px; }
.form-label {
  display: block;
  font-size: 11px;
  color: var(--muted);
  margin-bottom: 4px;
  font-family: 'DM Mono', monospace;
  letter-spacing: 0.5px;
}

.form-input, .form-select {
  width: 100%;
  padding: 8px 10px;
  border: 1px solid var(--border-dark);
  border-radius: 6px;
  font-size: 12px;
  font-family: 'Noto Sans JP', sans-serif;
  color: var(--text);
  background: var(--white);
  outline: none;
  transition: border 0.15s;
}

.form-input:focus, .form-select:focus { border-color: var(--accent); }

.form-grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

.modal-actions {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
  margin-top: 20px;
  padding-top: 16px;
  border-top: 1px solid var(--border);
}

/* Toast */
.toast {
  position: fixed;
  bottom: 24px;
  right: 24px;
  background: var(--text);
  color: white;
  padding: 10px 18px;
  border-radius: 8px;
  font-size: 12px;
  z-index: 200;
  display: none;
  animation: toastIn 0.3s ease;
}

.toast.show { display: flex; align-items: center; gap: 8px; }

@keyframes toastIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

/* Attendance Panel */
.month-selector {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 16px;
}

.month-btn {
  width: 28px; height: 28px;
  border: 1px solid var(--border-dark);
  border-radius: 6px;
  background: var(--white);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  transition: all 0.15s;
}

.month-btn:hover { background: var(--bg); }
.month-label { font-weight: 700; font-size: 14px; }

.attend-grid {
  background: var(--white);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
}

.attend-row {
  display: grid;
  grid-template-columns: 160px 1fr auto;
  align-items: center;
  padding: 10px 16px;
  border-bottom: 1px solid var(--border);
  gap: 16px;
  transition: background 0.1s;
}

.attend-row:hover { background: var(--row-hover); }
.attend-row:last-child { border-bottom: none; }
.attend-row.header { background: var(--bg); padding: 8px 16px; }

.attend-name { font-size: 12px; font-weight: 500; }
.attend-uni { font-size: 10px; color: var(--muted); }

.attend-toggle {
  width: 28px; height: 28px;
  border-radius: 6px;
  border: 1px solid var(--border-dark);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  transition: all 0.15s;
  background: var(--white);
}

.attend-toggle.present { background: var(--accent); border-color: var(--accent); color: white; }
.attend-toggle:hover { border-color: var(--accent); }

.attend-rate {
  font-family: 'DM Mono', monospace;
  font-size: 11px;
  color: var(--muted);
  width: 60px;
  text-align: right;
}

/* Mentoring log */
.mentor-list { display: flex; flex-direction: column; gap: 8px; }

.mentor-item {
  background: var(--white);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 14px 16px;
  display: grid;
  grid-template-columns: 1fr auto;
  align-items: start;
  gap: 12px;
  transition: all 0.15s;
}

.mentor-item:hover { border-color: var(--accent3); }

.mentor-who { font-weight: 500; font-size: 13px; margin-bottom: 4px; }
.mentor-meta { font-size: 11px; color: var(--muted); display: flex; gap: 12px; flex-wrap: wrap; }
.mentor-note { font-size: 11px; color: var(--text); margin-top: 6px; padding-top: 6px; border-top: 1px solid var(--border); }

.mentor-count {
  font-family: 'DM Mono', monospace;
  font-size: 22px;
  font-weight: 500;
  color: var(--accent3);
  text-align: center;
}

.mentor-count-label { font-size: 10px; color: var(--muted); text-align: center; }

/* Pitch panel */
.pitch-table-wrapper {
  background: var(--white);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
}

.progress-ring-container {
  display: flex;
  gap: 16px;
  margin-bottom: 20px;
}

.ring-card {
  background: var(--white);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 16px 20px;
  flex: 1;
  display: flex;
  align-items: center;
  gap: 14px;
}

.ring-info { }
.ring-value { font-family: 'DM Mono', monospace; font-size: 28px; font-weight: 500; }
.ring-label { font-size: 11px; color: var(--muted); }
.ring-bar { flex: 1; height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; }
.ring-fill { height: 100%; border-radius: 3px; }

/* Empty state */
.empty-state {
  text-align: center;
  padding: 48px 24px;
  color: var(--muted);
}
.empty-icon { font-size: 32px; margin-bottom: 10px; }
.empty-text { font-size: 13px; }

/* Responsive fix */
@media (max-width: 768px) {
  .stats-row { grid-template-columns: 1fr 1fr; }
  .sidebar { width: 60px; }
  .nav-label, .nav-count, .logo-title, .logo-sub { display: none; }
  .sidebar-logo { padding: 12px; }
}
</style>
</head>
<body>

<div class="app">
  <!-- ===== SIDEBAR ===== -->
  <aside class="sidebar">
    <div class="sidebar-logo">
      <div class="logo-badge">TIB</div>
      <div class="logo-title">å­¦ç”Ÿãƒ¡ãƒ³ãƒãƒ¼<br>ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </div>
      <div class="logo-sub">2026å¹´åº¦</div>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-section-label">MAIN</div>
      <div class="nav-item active" onclick="switchPanel('members')">
        <span class="nav-icon">ğŸ‘¥</span>
        <span class="nav-label">ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§</span>
        <span class="nav-count" id="nav-count-members">0</span>
      </div>
      <div class="nav-item" onclick="switchPanel('attendance')">
        <span class="nav-icon">ğŸ“…</span>
        <span class="nav-label">å‡ºå¸­ç®¡ç†</span>
      </div>
      <div class="nav-item" onclick="switchPanel('mentoring')">
        <span class="nav-icon">ğŸ’¬</span>
        <span class="nav-label">ãƒ¡ãƒ³ã‚¿ãƒªãƒ³ã‚°</span>
        <span class="nav-count" id="nav-count-mentor">0</span>
      </div>
      <div class="nav-item" onclick="switchPanel('pitch')">
        <span class="nav-icon">ğŸ¤</span>
        <span class="nav-label">ãƒ”ãƒƒãƒå¤§ä¼š</span>
      </div>
    </nav>
    <div class="sidebar-footer">v1.0 Â· 2026</div>
  </aside>

  <!-- ===== MAIN ===== -->
  <div class="main">
    <!-- Topbar -->
    <div class="topbar">
      <div>
        <div class="topbar-title" id="topbar-title">ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§</div>
        <div class="topbar-sub" id="topbar-sub">å…¨å­¦ç”Ÿãƒ¡ãƒ³ãƒãƒ¼ã®åŸºæœ¬æƒ…å ±ã‚’ç®¡ç†</div>
      </div>
      <div style="display:flex;align-items:center;gap:8px;margin-left:auto;">
        <div id="loading-indicator" style="display:none;align-items:center;gap:6px;font-size:11px;color:var(--muted);">
          <span style="animation:spin 1s linear infinite;">âš™ï¸</span>
          <span>åŒæœŸä¸­...</span>
        </div>
        <button class="btn btn-secondary btn-sm" onclick="loadAllData()" title="æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—">
          ğŸ”„ å†èª­ã¿è¾¼ã¿
        </button>
      </div>
      <div class="topbar-actions" id="topbar-actions">
        <button class="btn btn-primary" onclick="openAddModal()">ï¼‹ ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ </button>
      </div>
    </div>

    <!-- Content area -->
    <div class="content">

      <!-- ===== MEMBERS PANEL ===== -->
      <div id="panel-members" class="panel active">
        <div class="stats-row">
          <div class="stat-card green">
            <div class="stat-icon">ğŸ‘¥</div>
            <div class="stat-value" id="stat-total">0</div>
            <div class="stat-label">ç·ãƒ¡ãƒ³ãƒãƒ¼æ•°</div>
          </div>
          <div class="stat-card orange">
            <div class="stat-icon">â­</div>
            <div class="stat-value" id="stat-hosai">0</div>
            <div class="stat-label">é‹å–¶å§”å“¡è£œä½</div>
            <div class="stat-sub">ç›®æ¨™: 2åä»¥ä¸Š</div>
          </div>
          <div class="stat-card blue">
            <div class="stat-icon">ğŸ¨</div>
            <div class="stat-value" id="stat-creator">0</div>
            <div class="stat-label">ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ã‚º</div>
            <div class="stat-sub">ç›®æ¨™: 3åä»¥ä¸Š</div>
          </div>
          <div class="stat-card brown">
            <div class="stat-icon">ğŸ“Š</div>
            <div class="stat-value" id="stat-active-rate">â€”</div>
            <div class="stat-label">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ç‡</div>
            <div class="stat-sub">ç›®æ¨™: 50%ä»¥ä¸Š</div>
          </div>
        </div>

        <div class="table-wrapper">
          <div class="table-header">
            <span class="table-header-title">ãƒ¡ãƒ³ãƒãƒ¼</span>
            <span style="font-size:11px;color:var(--muted);" id="member-count-label">0å</span>
            <div class="search-box">
              <span>ğŸ”</span>
              <input type="text" id="member-search" placeholder="åå‰ãƒ»å¤§å­¦ã§æ¤œç´¢..." oninput="filterMembers()">
            </div>
          </div>
          <table>
            <thead>
              <tr>
                <th>åå‰</th>
                <th>å¤§å­¦</th>
                <th>å­¦å¹´</th>
                <th>å½¹å‰²</th>
                <th>é–¢å¿ƒåˆ†é‡</th>
                <th>é€£çµ¡å…ˆ</th>
                <th>ç™»éŒ²æ—¥</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="member-tbody"></tbody>
          </table>
        </div>
      </div>

      <!-- ===== ATTENDANCE PANEL ===== -->
      <div id="panel-attendance" class="panel">
        <div class="stats-row">
          <div class="stat-card green">
            <div class="stat-icon">âœ…</div>
            <div class="stat-value" id="attend-present-count">0</div>
            <div class="stat-label">ä»Šæœˆå‡ºå¸­</div>
          </div>
          <div class="stat-card orange">
            <div class="stat-icon">âŒ</div>
            <div class="stat-value" id="attend-absent-count">0</div>
            <div class="stat-label">ä»Šæœˆæ¬ å¸­</div>
          </div>
          <div class="stat-card blue">
            <div class="stat-icon">ğŸ“ˆ</div>
            <div class="stat-value" id="attend-rate-display">â€”</div>
            <div class="stat-label">ä»Šæœˆå‡ºå¸­ç‡</div>
            <div class="stat-sub">ç›®æ¨™: 50%ä»¥ä¸Š</div>
          </div>
          <div class="stat-card brown">
            <div class="stat-icon">ğŸ—“</div>
            <div class="stat-value" id="attend-months">0</div>
            <div class="stat-label">è¨˜éŒ²æ¸ˆã¿æœˆæ•°</div>
          </div>
        </div>

        <div class="month-selector">
          <button class="month-btn" onclick="changeMonth(-1)">â€¹</button>
          <span class="month-label" id="month-display">2026å¹´4æœˆ</span>
          <button class="month-btn" onclick="changeMonth(1)">â€º</button>
          <span style="font-size:11px;color:var(--muted);margin-left:8px;">æœˆä¾‹ä¼šå‡ºå¸­ã‚’è¨˜éŒ²</span>
          <button class="btn btn-secondary btn-sm" style="margin-left:auto;" onclick="saveAttendance()">ğŸ’¾ ä¿å­˜</button>
        </div>

        <div class="attend-grid">
          <div class="attend-row header">
            <span style="font-size:10px;font-family:'DM Mono',monospace;color:var(--muted);">MEMBER</span>
            <span style="font-size:10px;font-family:'DM Mono',monospace;color:var(--muted);">ä»Šæœˆ</span>
            <span style="font-size:10px;font-family:'DM Mono',monospace;color:var(--muted);width:60px;text-align:right;">ç´¯è¨ˆç‡</span>
          </div>
          <div id="attendance-list"></div>
        </div>
      </div>

      <!-- ===== MENTORING PANEL ===== -->
      <div id="panel-mentoring" class="panel">
        <div class="stats-row">
          <div class="stat-card blue">
            <div class="stat-icon">ğŸ’¬</div>
            <div class="stat-value" id="stat-mentor-total">0</div>
            <div class="stat-label">ç·ãƒ¡ãƒ³ã‚¿ãƒªãƒ³ã‚°å›æ•°</div>
            <div class="stat-sub">ç›®æ¨™: å¹´é–“12å›</div>
          </div>
          <div class="stat-card green">
            <div class="stat-icon">ğŸ‘¤</div>
            <div class="stat-value" id="stat-mentor-unique">0</div>
            <div class="stat-label">å¯¾è±¡å­¦ç”Ÿæ•°</div>
          </div>
          <div class="stat-card orange">
            <div class="stat-icon">ğŸ“‹</div>
            <div class="stat-value" id="stat-mentor-this-month">0</div>
            <div class="stat-label">ä»Šæœˆã®å®Ÿæ–½æ•°</div>
          </div>
          <div class="stat-card brown">
            <div class="stat-icon">ğŸ¯</div>
            <div class="stat-value" id="stat-mentor-progress">0%</div>
            <div class="stat-label">å¹´é–“ç›®æ¨™é€²æ—</div>
          </div>
        </div>

        <div class="table-wrapper" style="margin-bottom:16px;">
          <div class="table-header">
            <span class="table-header-title">ãƒ¡ãƒ³ã‚¿ãƒªãƒ³ã‚°è¨˜éŒ²</span>
            <div class="topbar-actions" style="margin-left:auto;">
              <button class="btn btn-primary btn-sm" onclick="openMentorModal()">ï¼‹ è¨˜éŒ²è¿½åŠ </button>
            </div>
          </div>
          <div id="mentor-list" class="mentor-list" style="padding:12px;"></div>
        </div>
      </div>

      <!-- ===== PITCH PANEL ===== -->
      <div id="panel-pitch" class="panel">
        <div class="progress-ring-container">
          <div class="ring-card">
            <div class="ring-info">
              <div class="ring-value" id="pitch-tib-rate">â€”%</div>
              <div class="ring-label">TIBæ‰€å±ç‡</div>
              <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace;margin-top:2px;">ç›®æ¨™: 80%ä»¥ä¸Š</div>
            </div>
            <div style="display:flex;flex-direction:column;gap:4px;flex:1;">
              <div class="ring-bar"><div class="ring-fill" id="pitch-bar" style="width:0%;background:var(--accent);"></div></div>
            </div>
          </div>
          <div class="ring-card">
            <div class="ring-info">
              <div class="ring-value" id="pitch-total">0</div>
              <div class="ring-label">ç™»éŒ²ãƒãƒ¼ãƒ æ•°</div>
            </div>
          </div>
          <div class="ring-card">
            <div class="ring-info">
              <div class="ring-value" id="pitch-mentor3">0</div>
              <div class="ring-label">3å›ä»¥ä¸Šãƒ¡ãƒ³ã‚¿ãƒªãƒ³ã‚°æ¸ˆ</div>
              <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace;margin-top:2px;">ç›®æ¨™: å…¨ãƒãƒ¼ãƒ </div>
            </div>
          </div>
        </div>

        <div class="table-wrapper">
          <div class="table-header">
            <span class="table-header-title">ãƒ”ãƒƒãƒå¤§ä¼š å‚åŠ ãƒãƒ¼ãƒ </span>
            <div style="margin-left:auto;">
              <button class="btn btn-primary btn-sm" onclick="openPitchModal()">ï¼‹ ãƒãƒ¼ãƒ ç™»éŒ²</button>
            </div>
          </div>
          <table>
            <thead>
              <tr>
                <th>ãƒãƒ¼ãƒ å</th>
                <th>ä»£è¡¨è€…</th>
                <th>TIBæ‰€å±</th>
                <th>ãƒ¡ãƒ³ã‚¿ãƒªãƒ³ã‚°å›æ•°</th>
                <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                <th>ç™»éŒ²æ—¥</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="pitch-tbody"></tbody>
          </table>
        </div>
      </div>

    </div><!-- /content -->
  </div><!-- /main -->
</div><!-- /app -->

<!-- ===== MODAL: Add Member ===== -->
<div class="modal-overlay" id="modal-member">
  <div class="modal">
    <div class="modal-title">ğŸ‘¤ ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ </div>
    <div class="form-grid-2">
      <div class="form-row">
        <label class="form-label">åå‰ *</label>
        <input class="form-input" id="m-name" placeholder="å±±ç”° å¤ªéƒ">
      </div>
      <div class="form-row">
        <label class="form-label">ã‚ˆã¿ãŒãª</label>
        <input class="form-input" id="m-kana" placeholder="ã‚„ã¾ã  ãŸã‚ã†">
      </div>
    </div>
    <div class="form-grid-2">
      <div class="form-row">
        <label class="form-label">å¤§å­¦å *</label>
        <input class="form-input" id="m-uni" placeholder="â—‹â—‹å¤§å­¦">
      </div>
      <div class="form-row">
        <label class="form-label">å­¦å¹´ *</label>
        <select class="form-select" id="m-grade">
          <option value="">é¸æŠ</option>
          <option>å­¦éƒ¨1å¹´</option><option>å­¦éƒ¨2å¹´</option><option>å­¦éƒ¨3å¹´</option><option>å­¦éƒ¨4å¹´</option>
          <option>ä¿®å£«1å¹´</option><option>ä¿®å£«2å¹´</option><option>åšå£«</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <label class="form-label">å½¹å‰²</label>
      <select class="form-select" id="m-role">
        <option value="ä¸€èˆ¬ãƒ¡ãƒ³ãƒãƒ¼">ä¸€èˆ¬ãƒ¡ãƒ³ãƒãƒ¼</option>
        <option value="é‹å–¶å§”å“¡è£œä½">é‹å–¶å§”å“¡è£œä½</option>
        <option value="ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ã‚º">ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ã‚º</option>
      </select>
    </div>
    <div class="form-row">
      <label class="form-label">é–¢å¿ƒåˆ†é‡</label>
      <input class="form-input" id="m-interest" placeholder="ä¾‹: ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—, AI, ãƒ‡ã‚¶ã‚¤ãƒ³">
    </div>
    <div class="form-row">
      <label class="form-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
      <input class="form-input" id="m-email" type="email" placeholder="example@mail.com">
    </div>
    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="closeModal('modal-member')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="btn btn-primary" onclick="addMember()">è¿½åŠ ã™ã‚‹</button>
    </div>
  </div>
</div>

<!-- ===== MODAL: Mentoring ===== -->
<div class="modal-overlay" id="modal-mentor">
  <div class="modal">
    <div class="modal-title">ğŸ’¬ ãƒ¡ãƒ³ã‚¿ãƒªãƒ³ã‚°è¨˜éŒ²</div>
    <div class="form-grid-2">
      <div class="form-row">
        <label class="form-label">å¯¾è±¡ãƒ¡ãƒ³ãƒãƒ¼ *</label>
        <select class="form-select" id="mt-member"></select>
      </div>
      <div class="form-row">
        <label class="form-label">å®Ÿæ–½æ—¥ *</label>
        <input class="form-input" id="mt-date" type="date">
      </div>
    </div>
    <div class="form-grid-2">
      <div class="form-row">
        <label class="form-label">ãƒ¡ãƒ³ã‚¿ãƒ¼å</label>
        <input class="form-input" id="mt-mentor" placeholder="æ‹…å½“ãƒ¡ãƒ³ã‚¿ãƒ¼å">
      </div>
      <div class="form-row">
        <label class="form-label">å½¢å¼</label>
        <select class="form-select" id="mt-type">
          <option>å¯¾é¢</option><option>ã‚ªãƒ³ãƒ©ã‚¤ãƒ³</option><option>ã‚°ãƒ«ãƒ¼ãƒ—</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <label class="form-label">ãƒ†ãƒ¼ãƒãƒ»å†…å®¹ãƒ¡ãƒ¢</label>
      <input class="form-input" id="mt-note" placeholder="ä¾‹: ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«æ¤œè¨ã€ãƒ”ãƒƒãƒè³‡æ–™ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯">
    </div>
    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="closeModal('modal-mentor')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="btn btn-primary" onclick="addMentoring()">è¨˜éŒ²ã™ã‚‹</button>
    </div>
  </div>
</div>

<!-- ===== MODAL: Pitch Team ===== -->
<div class="modal-overlay" id="modal-pitch">
  <div class="modal">
    <div class="modal-title">ğŸ¤ ãƒãƒ¼ãƒ ç™»éŒ²</div>
    <div class="form-grid-2">
      <div class="form-row">
        <label class="form-label">ãƒãƒ¼ãƒ å *</label>
        <input class="form-input" id="pt-team" placeholder="ãƒãƒ¼ãƒ å">
      </div>
      <div class="form-row">
        <label class="form-label">ä»£è¡¨è€…å *</label>
        <input class="form-input" id="pt-leader" placeholder="ä»£è¡¨è€…å">
      </div>
    </div>
    <div class="form-row">
      <label class="form-label">TIBå­¦ç”Ÿãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—æ‰€å±</label>
      <select class="form-select" id="pt-tib">
        <option value="yes">æ‰€å±ã‚ã‚Š</option>
        <option value="no">æ‰€å±ãªã—ï¼ˆè¦ç™»éŒ²ï¼‰</option>
      </select>
    </div>
    <div class="form-row">
      <label class="form-label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
      <select class="form-select" id="pt-status">
        <option>å¿œå‹Ÿæ¸ˆ</option><option>ãƒ¡ãƒ³ã‚¿ãƒªãƒ³ã‚°ä¸­</option><option>ç™»å£‡ç¢ºå®š</option><option>è¾é€€</option>
      </select>
    </div>
    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="closeModal('modal-pitch')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="btn btn-primary" onclick="addPitchTeam()">ç™»éŒ²ã™ã‚‹</button>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast">âœ… <span id="toast-msg"></span></div>

<script>
// ===== GOOGLE SHEETS API CONFIG =====
// âš ï¸ é‡è¦: ä»¥ä¸‹ã®URLã‚’ã‚ãªãŸã®Google Apps Scriptã®ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªURLã«ç½®ãæ›ãˆã¦ãã ã•ã„
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxoXwDA8NyQhbHPKzzMkz4nRgkEyxWF-mTFJhD_7pdiOZN9vXgvYEu2RJIpwLEC_z3I7w/exec';

// ===== DATA =====
let members = [];
let attendance = {};
let mentoringLogs = [];
let pitchTeams = [];

let currentMonth = { year: 2026, month: 4 };
let isLoading = false;

// ===== API FUNCTIONS =====
async function apiCall(action, data = null) {
  if (!SCRIPT_URL || SCRIPT_URL.includes('ã“ã“ã«')) {
    showToast('âš  GASã®URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚setup-guide.mdã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚', true);
    return null;
  }

  try {
    isLoading = true;
    updateLoadingState();

    let url = `${SCRIPT_URL}?action=${action}`;
    let options = { method: 'GET' };

    if (data) {
      url += `&data=${encodeURIComponent(JSON.stringify(data))}`;
    }

    const response = await fetch(url);
    const result = await response.json();

    if (!result.success && result.error) {
      throw new Error(result.error);
    }

    return result.data;
  } catch (error) {
    console.error('API Error:', error);
    showToast('âš  ãƒ‡ãƒ¼ã‚¿ã®å–å¾—/ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message, true);
    return null;
  } finally {
    isLoading = false;
    updateLoadingState();
  }
}

async function loadAllData() {
  showToast('ğŸ“¡ ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...');
  
  const [membersData, attendanceData, mentoringData, pitchData] = await Promise.all([
    apiCall('getMembers'),
    apiCall('getAttendance'),
    apiCall('getMentoring'),
    apiCall('getPitchTeams')
  ]);

  if (membersData) members = membersData;
  if (attendanceData) attendance = attendanceData;
  if (mentoringData) mentoringLogs = mentoringData;
  if (pitchData) pitchTeams = pitchData;

  render();
  showToast('âœ… æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
}

function updateLoadingState() {
  const indicator = document.getElementById('loading-indicator');
  if (indicator) {
    indicator.style.display = isLoading ? 'flex' : 'none';
  }
}

// ===== PANELS =====
const panels = {
  members: { title: 'ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§', sub: 'å…¨å­¦ç”Ÿãƒ¡ãƒ³ãƒãƒ¼ã®åŸºæœ¬æƒ…å ±ã‚’ç®¡ç†' },
  attendance: { title: 'æœˆä¾‹ä¼š å‡ºå¸­ç®¡ç†', sub: 'æœˆã”ã¨ã®å‡ºå¸­ã‚’è¨˜éŒ²ãƒ»é›†è¨ˆ' },
  mentoring: { title: 'ãƒ¡ãƒ³ã‚¿ãƒªãƒ³ã‚°è¨˜éŒ²', sub: 'å­¦ç”Ÿã¸ã®ãƒ¡ãƒ³ã‚¿ãƒªãƒ³ã‚°å®Ÿæ–½å±¥æ­´' },
  pitch: { title: 'ãƒ”ãƒƒãƒå¤§ä¼š ç®¡ç†', sub: '2æœˆãƒ”ãƒƒãƒå¤§ä¼šã®ãƒãƒ¼ãƒ ã¨é€²æ—ã‚’ç®¡ç†' },
};

function switchPanel(id) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('panel-' + id).classList.add('active');
  document.querySelector(`.nav-item[onclick="switchPanel('${id}')"]`).classList.add('active');
  document.getElementById('topbar-title').textContent = panels[id].title;
  document.getElementById('topbar-sub').textContent = panels[id].sub;

  // Update topbar actions
  const actions = document.getElementById('topbar-actions');
  if (id === 'members') {
    actions.innerHTML = `<button class="btn btn-primary" onclick="openAddModal()">ï¼‹ ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ </button>`;
  } else if (id === 'attendance') {
    actions.innerHTML = ``;
  } else if (id === 'mentoring') {
    actions.innerHTML = `<button class="btn btn-primary" onclick="openMentorModal()">ï¼‹ è¨˜éŒ²è¿½åŠ </button>`;
  } else if (id === 'pitch') {
    actions.innerHTML = `<button class="btn btn-primary" onclick="openPitchModal()">ï¼‹ ãƒãƒ¼ãƒ ç™»éŒ²</button>`;
  }

  render();
}

// ===== RENDER =====
function render() {
  renderMembers();
  renderAttendance();
  renderMentoring();
  renderPitch();
  updateNavCounts();
}

function renderMembers(filter = '') {
  const query = (filter || document.getElementById('member-search')?.value || '').toLowerCase();
  const filtered = members.filter(m =>
    m.name.toLowerCase().includes(query) ||
    m.uni.toLowerCase().includes(query) ||
    (m.interest || '').toLowerCase().includes(query)
  );

  document.getElementById('member-count-label').textContent = filtered.length + 'å';
  document.getElementById('stat-total').textContent = members.length;
  document.getElementById('stat-hosai').textContent = members.filter(m => m.role === 'é‹å–¶å§”å“¡è£œä½').length;
  document.getElementById('stat-creator').textContent = members.filter(m => m.role === 'ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ã‚º').length;

  // Active rate
  const key = `${currentMonth.year}-${String(currentMonth.month).padStart(2,'0')}`;
  const att = attendance[key] || {};
  const presentCount = members.filter(m => att[m.id]).length;
  const rate = members.length > 0 ? Math.round(presentCount / members.length * 100) : 0;
  document.getElementById('stat-active-rate').textContent = members.length > 0 ? rate + '%' : 'â€”';

  const tbody = document.getElementById('member-tbody');
  if (filtered.length === 0) {
    tbody.innerHTML = `<tr><td colspan="8"><div class="empty-state"><div class="empty-icon">ğŸ‘¤</div><div class="empty-text">ãƒ¡ãƒ³ãƒãƒ¼ãŒã„ã¾ã›ã‚“</div></div></td></tr>`;
    return;
  }

  tbody.innerHTML = filtered.map(m => {
    const roleColor = m.role === 'é‹å–¶å§”å“¡è£œä½' ? 'tag-orange' : m.role === 'ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ã‚º' ? 'tag-blue' : 'tag-gray';
    return `<tr>
      <td><strong>${m.name}</strong><br><span style="font-size:10px;color:var(--muted);">${m.kana || ''}</span></td>
      <td>${m.uni}</td>
      <td>${m.grade}</td>
      <td><span class="tag ${roleColor}">${m.role}</span></td>
      <td style="max-width:140px;"><span style="font-size:11px;color:var(--muted);">${m.interest || 'â€”'}</span></td>
      <td style="font-size:11px;color:var(--muted);">${m.email || 'â€”'}</td>
      <td style="font-size:11px;color:var(--muted);font-family:'DM Mono',monospace;">${m.createdAt}</td>
      <td>
        <button class="btn btn-secondary btn-sm" onclick="deleteMember(${m.id})" style="padding:3px 8px;font-size:10px;">å‰Šé™¤</button>
      </td>
    </tr>`;
  }).join('');
}

function filterMembers() {
  renderMembers();
}

function renderAttendance() {
  const key = `${currentMonth.year}-${String(currentMonth.month).padStart(2,'0')}`;
  const att = attendance[key] || {};

  document.getElementById('month-display').textContent = `${currentMonth.year}å¹´${currentMonth.month}æœˆ`;

  const presentCount = members.filter(m => att[m.id]).length;
  const absentCount = members.length - presentCount;
  const rate = members.length > 0 ? Math.round(presentCount / members.length * 100) : 0;

  document.getElementById('attend-present-count').textContent = presentCount;
  document.getElementById('attend-absent-count').textContent = absentCount;
  document.getElementById('attend-rate-display').textContent = members.length > 0 ? rate + '%' : 'â€”';
  document.getElementById('attend-months').textContent = Object.keys(attendance).length;

  const container = document.getElementById('attendance-list');
  if (members.length === 0) {
    container.innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ“…</div><div class="empty-text">ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</div></div>`;
    return;
  }

  container.innerHTML = members.map(m => {
    const isPresent = !!att[m.id];
    // Calc cumulative rate
    const allKeys = Object.keys(attendance);
    const totalMonths = allKeys.length;
    const presentMonths = allKeys.filter(k => attendance[k][m.id]).length;
    const cumRate = totalMonths > 0 ? Math.round(presentMonths / totalMonths * 100) : 'â€”';

    return `<div class="attend-row">
      <div>
        <div class="attend-name">${m.name}</div>
        <div class="attend-uni">${m.uni} Â· ${m.grade}</div>
      </div>
      <button class="attend-toggle ${isPresent ? 'present' : ''}" onclick="toggleAttend(${m.id})" data-id="${m.id}">
        ${isPresent ? 'âœ“' : ''}
      </button>
      <div class="attend-rate">${typeof cumRate === 'number' ? cumRate + '%' : 'â€”'}</div>
    </div>`;
  }).join('');
}

function toggleAttend(memberId) {
  const key = `${currentMonth.year}-${String(currentMonth.month).padStart(2,'0')}`;
  if (!attendance[key]) attendance[key] = {};
  attendance[key][memberId] = !attendance[key][memberId];
  renderAttendance();
  renderMembers();
}

function changeMonth(dir) {
  currentMonth.month += dir;
  if (currentMonth.month > 12) { currentMonth.month = 1; currentMonth.year++; }
  if (currentMonth.month < 1) { currentMonth.month = 12; currentMonth.year--; }
  renderAttendance();
}

async function saveAttendance() {
  const result = await apiCall('saveAttendance', attendance);
  if (result) {
    showToast('âœ… å‡ºå¸­ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
  }
}

function renderMentoring() {
  const now = new Date();
  const thisMonthKey = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;

  const total = mentoringLogs.length;
  const uniqueMembers = new Set(mentoringLogs.map(l => l.memberId)).size;
  const thisMonth = mentoringLogs.filter(l => l.date.startsWith(thisMonthKey.replace('-0','-'))).length;
  const progress = Math.min(Math.round(total / 12 * 100), 100);

  document.getElementById('stat-mentor-total').textContent = total;
  document.getElementById('stat-mentor-unique').textContent = uniqueMembers;
  document.getElementById('stat-mentor-this-month').textContent = thisMonth;
  document.getElementById('stat-mentor-progress').textContent = progress + '%';

  const container = document.getElementById('mentor-list');
  if (mentoringLogs.length === 0) {
    container.innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ’¬</div><div class="empty-text">è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã€Œï¼‹ è¨˜éŒ²è¿½åŠ ã€ã‹ã‚‰è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</div></div>`;
    return;
  }

  const sorted = [...mentoringLogs].sort((a, b) => b.date.localeCompare(a.date));
  container.innerHTML = sorted.map(log => {
    const member = members.find(m => m.id === log.memberId);
    const memberName = member ? member.name : 'ä¸æ˜';
    return `<div class="mentor-item">
      <div>
        <div class="mentor-who">${memberName} <span style="font-weight:400;color:var(--muted);">ã¸ã®ãƒ¡ãƒ³ã‚¿ãƒªãƒ³ã‚°</span></div>
        <div class="mentor-meta">
          <span>ğŸ“… ${log.date}</span>
          <span>ğŸ‘¤ ${log.mentor || 'â€”'}</span>
          <span class="tag tag-blue">${log.type}</span>
        </div>
        ${log.note ? `<div class="mentor-note">ğŸ“ ${log.note}</div>` : ''}
      </div>
      <div>
        <button class="btn btn-danger btn-sm" onclick="deleteMentor(${log.id})">å‰Šé™¤</button>
      </div>
    </div>`;
  }).join('');
}

function renderPitch() {
  const total = pitchTeams.length;
  const tibCount = pitchTeams.filter(t => t.tib === 'yes').length;
  const tibRate = total > 0 ? Math.round(tibCount / total * 100) : 0;

  // Count teams with 3+ mentoring sessions
  const mentor3 = pitchTeams.filter(t => {
    const leader = members.find(m => m.name === t.leader);
    if (!leader) return false;
    const count = mentoringLogs.filter(l => l.memberId === leader.id).length;
    return count >= 3;
  }).length;

  document.getElementById('pitch-tib-rate').textContent = total > 0 ? tibRate + '%' : 'â€”';
  document.getElementById('pitch-bar').style.width = tibRate + '%';
  document.getElementById('pitch-bar').style.background = tibRate >= 80 ? 'var(--accent)' : tibRate >= 50 ? 'var(--accent4)' : 'var(--accent2)';
  document.getElementById('pitch-total').textContent = total;
  document.getElementById('pitch-mentor3').textContent = mentor3;

  const tbody = document.getElementById('pitch-tbody');
  if (pitchTeams.length === 0) {
    tbody.innerHTML = `<tr><td colspan="7"><div class="empty-state"><div class="empty-icon">ğŸ¤</div><div class="empty-text">ãƒãƒ¼ãƒ ãŒã‚ã‚Šã¾ã›ã‚“</div></div></td></tr>`;
    return;
  }

  tbody.innerHTML = pitchTeams.map(t => {
    const tibTag = t.tib === 'yes' ? '<span class="tag tag-green">âœ“ æ‰€å±ã‚ã‚Š</span>' : '<span class="tag tag-orange">âš  è¦ç™»éŒ²</span>';
    const statusTag = {
      'å¿œå‹Ÿæ¸ˆ': 'tag-gray',
      'ãƒ¡ãƒ³ã‚¿ãƒªãƒ³ã‚°ä¸­': 'tag-blue',
      'ç™»å£‡ç¢ºå®š': 'tag-green',
      'è¾é€€': 'tag-orange'
    }[t.status] || 'tag-gray';

    const leader = members.find(m => m.name === t.leader);
    const mentorCount = leader ? mentoringLogs.filter(l => l.memberId === leader.id).length : 0;
    const barW = Math.min(mentorCount / 3 * 100, 100);

    return `<tr>
      <td><strong>${t.team}</strong></td>
      <td>${t.leader}</td>
      <td>${tibTag}</td>
      <td>
        <div style="display:flex;align-items:center;gap:6px;">
          <div class="mini-bar"><div class="mini-bar-fill" style="width:${barW}%"></div></div>
          <span style="font-family:'DM Mono',monospace;font-size:11px;">${mentorCount}/3å›</span>
        </div>
      </td>
      <td><span class="tag ${statusTag}">${t.status}</span></td>
      <td style="font-size:11px;color:var(--muted);font-family:'DM Mono',monospace;">${t.createdAt}</td>
      <td><button class="btn btn-danger btn-sm" onclick="deletePitch(${t.id})">å‰Šé™¤</button></td>
    </tr>`;
  }).join('');
}

function updateNavCounts() {
  document.getElementById('nav-count-members').textContent = members.length;
  document.getElementById('nav-count-mentor').textContent = mentoringLogs.length;
}

// ===== MODALS =====
function openAddModal() {
  ['m-name','m-kana','m-uni','m-email','m-interest'].forEach(id => document.getElementById(id).value = '');
  document.getElementById('m-grade').value = '';
  document.getElementById('m-role').value = 'ä¸€èˆ¬ãƒ¡ãƒ³ãƒãƒ¼';
  document.getElementById('modal-member').classList.add('open');
}

function openMentorModal() {
  const sel = document.getElementById('mt-member');
  sel.innerHTML = members.map(m => `<option value="${m.id}">${m.name}</option>`).join('');
  document.getElementById('mt-date').value = new Date().toISOString().split('T')[0];
  document.getElementById('mt-mentor').value = '';
  document.getElementById('mt-note').value = '';
  document.getElementById('modal-mentor').classList.add('open');
}

function openPitchModal() {
  ['pt-team','pt-leader'].forEach(id => document.getElementById(id).value = '');
  document.getElementById('pt-tib').value = 'yes';
  document.getElementById('pt-status').value = 'å¿œå‹Ÿæ¸ˆ';
  document.getElementById('modal-pitch').classList.add('open');
}

function closeModal(id) {
  document.getElementById(id).classList.remove('open');
}

// Close on overlay click
document.querySelectorAll('.modal-overlay').forEach(el => {
  el.addEventListener('click', e => { if (e.target === el) el.classList.remove('open'); });
});

// ===== ADD ACTIONS =====
async function addMember() {
  const name = document.getElementById('m-name').value.trim();
  const uni = document.getElementById('m-uni').value.trim();
  const grade = document.getElementById('m-grade').value;
  if (!name || !uni || !grade) { showToast('âš  åå‰ãƒ»å¤§å­¦ãƒ»å­¦å¹´ã¯å¿…é ˆã§ã™', true); return; }

  const memberData = {
    name,
    kana: document.getElementById('m-kana').value.trim(),
    uni,
    grade,
    role: document.getElementById('m-role').value,
    interest: document.getElementById('m-interest').value.trim(),
    email: document.getElementById('m-email').value.trim(),
    createdAt: new Date().toISOString().split('T')[0]
  };

  const result = await apiCall('addMember', memberData);
  if (result) {
    closeModal('modal-member');
    await loadAllData();
    showToast(`âœ… ${name} ã‚’è¿½åŠ ã—ã¾ã—ãŸ`);
  }
}

async function addMentoring() {
  const memberId = parseInt(document.getElementById('mt-member').value);
  const date = document.getElementById('mt-date').value;
  if (!memberId || !date) { showToast('âš  å¯¾è±¡è€…ã¨æ—¥ä»˜ã¯å¿…é ˆã§ã™', true); return; }

  const logData = {
    memberId,
    date,
    mentor: document.getElementById('mt-mentor').value.trim(),
    type: document.getElementById('mt-type').value,
    note: document.getElementById('mt-note').value.trim()
  };

  const result = await apiCall('addMentoring', logData);
  if (result) {
    closeModal('modal-mentor');
    await loadAllData();
    showToast('âœ… ãƒ¡ãƒ³ã‚¿ãƒªãƒ³ã‚°è¨˜éŒ²ã‚’è¿½åŠ ã—ã¾ã—ãŸ');
  }
}

async function addPitchTeam() {
  const team = document.getElementById('pt-team').value.trim();
  const leader = document.getElementById('pt-leader').value.trim();
  if (!team || !leader) { showToast('âš  ãƒãƒ¼ãƒ åã¨ä»£è¡¨è€…ã¯å¿…é ˆã§ã™', true); return; }

  const teamData = {
    team,
    leader,
    tib: document.getElementById('pt-tib').value,
    status: document.getElementById('pt-status').value,
    createdAt: new Date().toISOString().split('T')[0]
  };

  const result = await apiCall('addPitchTeam', teamData);
  if (result) {
    closeModal('modal-pitch');
    await loadAllData();
    showToast(`âœ… ${team} ã‚’ç™»éŒ²ã—ã¾ã—ãŸ`);
  }
}

// ===== DELETE =====
async function deleteMember(id) {
  if (!confirm('ã“ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
  const result = await apiCall('deleteMember', { id });
  if (result) {
    await loadAllData();
    showToast('âœ… å‰Šé™¤ã—ã¾ã—ãŸ');
  }
}

async function deleteMentor(id) {
  if (!confirm('ã“ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
  const result = await apiCall('deleteMentoring', { id });
  if (result) {
    await loadAllData();
    showToast('âœ… å‰Šé™¤ã—ã¾ã—ãŸ');
  }
}

async function deletePitch(id) {
  if (!confirm('ã“ã®ãƒãƒ¼ãƒ ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
  const result = await apiCall('deletePitchTeam', { id });
  if (result) {
    await loadAllData();
    showToast('âœ… å‰Šé™¤ã—ã¾ã—ãŸ');
  }
}

// ===== TOAST =====
function showToast(msg, isWarning = false) {
  const t = document.getElementById('toast');
  const m = document.getElementById('toast-msg');
  t.innerHTML = (isWarning ? 'âš  ' : 'âœ… ') + msg;
  t.classList.add('show');
  t.style.background = isWarning ? 'var(--accent2)' : 'var(--text)';
  setTimeout(() => t.classList.remove('show'), 2800);
}

// ===== INIT =====
window.addEventListener('DOMContentLoaded', () => {
  loadAllData();
});

// ===== TOAST =====</script>
</body>
</html>
